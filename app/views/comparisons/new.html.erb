<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column">
        <h3 class="title is-3">Product Picker</h3>
        <div data-controller="comparison-select">
          <%= form_with(model: ComparisonProduct.new) do |form| %>
            <div class="field">
              <div class="control">
                <div class="select">
                  <%= form.select :insurer, options_from_collection_for_select(@insurers, "id", "name"), {prompt: 'Select Insurer...'}, data: {target: 'comparison-select.insurer', action: 'change->comparison-select#getProducts'}, id: 'insurer-select' %>
                </div>
              </div>
            </div>
            <div class="field">
              <div class="control">
                <div class="select">
                  <%= form.select :product, options_for_select([]), {prompt: 'Select Product'}, data: { target: 'comparison-select.product', action: 'change->comparison-select#getProductModules' }, id: 'product-select' %>
                </div>
              </div>
            </div>
            <div id="product-modules" data-target="comparison-select.productModules">
            </div>
            <div class="field">
              <div class="control">
                <%= form.submit "Load Benefits", class: 'button is-primary', data: { action: 'click->comparison-select#loadBenefits' } %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      <div class="column">
        <div id="accordian">
          <table id="accordian" class="table">
            <tbody>
              <tr>
                <td colspan="100%"><a href="#collapsible-section-1" data-action="collapse">Product Details</a></td>
              </tr>
            </tbody>
            <tbody id="collapsible-section-1" class="is-collapsible" data-parent="accordian" data-allow-multiple="true">
              <tr>
                <td>Insurer</td>
              </tr>
              <tr>
                <td>Product</td>
              </tr>
              <tr>
                <td>Chosen Cover</td>
              </tr>
              <tr>
                <td>Overall Sum Assured</td>
              </tr>
            </tbody>
            <% @benefit_categories.each do |category| %>
              <tbody>
                <tr>
                  <td colspan="100%"><a href=<%= "#collapsible-section-#{category}" %> data-action="collapse"><%= category.titleize %></a></td>
                </tr>
              </tbody>
              <tbody id=<%= "collapsible-section-#{category}" %> class="is-collapsible" data-parent="accordian" data-allow-multiple="true">
                <% @benefits[category].each do |benefit| %>
                  <tr>
                    <td><%= benefit.name.titleize %></td>
                  </tr>
                <% end %>
              </tbody>
            <% end %>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>
